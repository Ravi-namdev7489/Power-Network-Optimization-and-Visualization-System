{% extends 'base.html' %}

{% block title %}
Optimization
{% endblock title %}

{% block body %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

<style>
  body {
    background: #f6f9fc;
    font-family: 'Segoe UI', sans-serif;
  }

  .optimize-container {
    max-width: 700px;
    margin: 60px auto;
    background: #fff;
    padding: 2.5rem;
    border-radius: 20px;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.06);
    animation: fadeInUp 0.6s ease-out;
  }

  .optimize-container h2 {
    font-weight: 700;
    text-align: center;
    color: #333;
    margin-bottom: 1.5rem;
  }

  .btn-modern {
    font-size: 1.1rem;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 50px;
    transition: all 0.3s ease;
  }

  .btn-modern:hover {
    transform: scale(1.03);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.1);
  }

  .progress {
    height: 20px;
    border-radius: 30px;
    overflow: hidden;
    background-color: #e9ecef;
  }

  .progress-bar {
    font-weight: 600;
  }

  .cta-link {
    margin-top: 2rem;
    text-align: center;
  }

  .btn-block {
    width: 100%;
    margin-top: 10px;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<div class="container optimize-container">
  <h2>⚙️ Network Optimization</h2>

  <form id="optimize-form" action="/optimize-network" method="post" enctype="multipart/form-data">
    <div class="d-grid gap-2">
      <button type="submit" class="btn btn-warning btn-modern">
        <i class="fas fa-rocket me-2"></i> Start Optimization
      </button>
    </div>
  </form>

  <!-- Loading and Progress -->
  <div id="loading-message" class="mt-4" style="display: none;">
    <div class="d-flex align-items-center text-primary mb-2">
      <div class="spinner-border me-2" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <strong>Running optimization... Please wait</strong>
    </div>
    <div class="progress">
      <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-info" style="width: 0%;">
        0%
      </div>
    </div>
  </div>

  <!-- Result -->
  {% if result_text %}
    <div class="alert alert-info mt-4 text-center fw-semibold">
      {{ result_text }}
    </div>
  {% endif %}

  <!-- Call-to-action -->
  <div class="cta-link">
    <a href="/result" class="btn btn-success btn-lg btn-block">
      <i class="fa-solid fa-chart-line me-2"></i> Show Result
    </a>
    <a href="/folder1" class="btn btn-outline-primary btn-lg btn-block">
      <i class="fa-solid fa-folder-open me-2"></i> Back to Folder Upload
    </a>
  </div>
</div>

<!-- JavaScript for animated progress -->
<script>
  document.getElementById("optimize-form").addEventListener("submit", function () {
    const loadingMessage = document.getElementById("loading-message");
    const progressBar = document.getElementById("progress-bar");

    loadingMessage.style.display = "block";
    let width = 0;

    const interval = setInterval(() => {
      if (width >= 100) {
        clearInterval(interval);
      } else {
        width += Math.random() * 8;
        width = Math.min(99, width);
        progressBar.style.width = width + "%";
        progressBar.innerText = Math.round(width) + "%";
      }
    }, 200);
  });
</script>
{% endblock %}
